<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kalaha Board Game</title>
</head>
<style>
.Content{
    text-align: center;
    max-width: 800px;
    vertical-align: middle;
    margin: auto;
}
.TopUI{
    display:grid;
    grid-template-columns: 1fr 2fr 1fr;
    margin: 20px;
}
.Normal-Pits{
    display:grid;
    grid-template-columns: repeat(6, 1fr);
    grid-gap: 3px;
}
.Board{
    display:grid;
    grid-template-columns: repeat(8, 1fr);
    grid-template-rows: repeat(2, 1fr);
    grid-gap: 3px;
    padding: 10px;
    border: 20px solid #ffff;
    border-radius: 35px;
}

.GameContainer {
    background-color: #2196F3;
    padding:20px;
    font-size: 30px;
    border-radius: 50px;
}
.Kalaha-left{
    grid-column-start:1;
    grid-column-end:2;
    grid-row-start:1;
    grid-row-end:3;
}
.Kalaha-right{
    grid-column-start:8;
    grid-column-end:9;
    grid-row-start:1;
    grid-row-end:3;
}
.Pit {
    background-color: rgba(255,255,255,0.7);
    padding: 20px;
    margin:0;
    border: 3px solid #ffff;
    border-radius: 5px;
    display: flex;
    justify-content: center;
    align-items: center;
}
.Valid{
    border: 3px solid #ffff;
    animation: border-pulsate 2s infinite;
}
@keyframes border-pulsate {
    0%   { border-color: rgba(255, 255, 255, 1); }
    50%  { border-color: rgba(0, 0, 0, 1); }
    100% { border-color: rgba(255, 255, 255, 1); }
}
.Valid:Hover{
    background-color: rgba(255,255,255,0.9);
}
.Active{
    border: 3px solid #ffff;
    border-radius:20px;
    animation: border-pulsate 2s infinite;
}
.Player{
    border: 3px solid #ffff;
    border-radius:20px;
}
.Flex{
    display:flex;
}
.Rules{
    Font-size: 20px;
}
</style>

<body class="Content">
    <div class="Info">
        <H1>Kalaha Board Game</H1>
    </div>
    <div class="GameContainer">
        <div class="TopUI">
            <div class="UI-Element Player P1 Active">P1 Score: 0</div>
            <div class="UI-Element ">Turn: 10</div>
            <div class="UI-Element Player P2">P2 Score: 0</div>
        </div>
        <div class="Board">
            <div class="Kalaha-left Pit" value="0">0</div>
            <div class="Pit P1 Valid" value="1">6</div>
            <div class="Pit P1 Valid" value="2">6</div>
            <div class="Pit P1 Valid" value="3">6</div>
            <div class="Pit P1 Valid">6</div>
            <div class="Pit P1 Valid">6</div>
            <div class="Pit P1 Valid">6</div>
            <div class="Kalaha-right Pit">0</div>
            <div class="Pit P2">6</div>
            <div class="Pit P2">6</div>
            <div class="Pit P2">6</div>
            <div class="Pit P2">6</div>
            <div class="Pit P2">6</div>
            <div class="Pit P2">6</div>
        </div>
        <div class="Rules">
            <p>Rules explained here: <br/>
                Blabla<br/>
                BlablaS<br/>
            </p>
        </div>
    </div>
</body>

<script type="text/javascript" language="JavaScript">
    
    var activePlayer = 0;
    var errorLog;
    var pits;
    SetupGame();
    function SetupGame(){
        GetGame();       
        PreparePitFunctionality();
    }

    function PreparePitFunctionality(){
        pits = Array.prototype.slice.call(document.getElementsByClassName("Pit"));
        for(var i = 0; i < pits.length; i++){
            console.log(pits[i])
            console.log(i);
            if(i < 8)
                pits[i].value = i;
            else
                pits[i].value = 13 - i + 8;
            pits[i].onclick = function(){
                if(this.classList.contains("Valid")){
                    PostGame(this.value, activePlayer);
                }
                else{
                    console.log("Invalid Move");
                    console.log(this.value);
                }
            }
        }
        
        pits.sort((a,b) =>{
            return a.value < b.value ? -1 : 1;
        })
        console.log("Sorted");
        for(var i = 0; i < pits.length; i++){
            console.log(pits[i].value)
        }
    }

    function AssignValuesToPits(gameState){
        console.log("AssignValuesToPits");
        pits.forEach(element => {
            console.log(element.innerHTML);
        });
    }

    function GetGame(){
        console.log("GetGame");
        var result;
        fetch('/game')
        .then(response => response.json())
        .then(data =>{
            console.log(data);
            AssignValuesToPits(data);
        }).catch(error => console.log(error))
        return result;
    }

    function PostGame(Index, Player){
        console.log("PostGame");
        var result;
        postRequest('/game',{
            "SelectedBucket": Index,
            "PlayerID": Player,
            "ClientHash": 0
        }).then(data => {
            console.log(data);
            AssignValuesToPits(data);
        }) .catch(error => console.log(error));
    }

    function postRequest(url, data){
        return fetch(url, {
            credential: 'same-origin',
            method: 'POST',
            body: JSON.stringify(data),
            headers: new Headers({
                'Content-Type':'application/json'
            }),
        }).then(response => response.json())
    }

</script>

</html>